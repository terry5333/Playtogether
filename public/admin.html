<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>PartyBox Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
</head>
<body class="bg-slate-950 text-slate-200 p-8 font-sans">
    <div class="max-w-7xl mx-auto space-y-10">
        <div class="flex justify-between items-center border-b border-slate-800 pb-6">
            <h1 class="text-3xl font-black">SYSTEM <span class="text-indigo-500">ADMIN</span></h1>
        </div>

        <div class="grid lg:grid-cols-2 gap-10">
            <div class="bg-slate-900 rounded-[2rem] p-6 border border-slate-800">
                <h2 class="text-xl font-bold mb-6">ğŸ† å…¨çƒæˆ°ç¸¾èˆ‡ PIN ç¢¼</h2>
                <div id="user-list" class="space-y-3 max-h-[600px] overflow-y-auto pr-2"></div>
            </div>

            <div class="bg-slate-900 rounded-[2rem] p-6 border border-slate-800">
                <h2 class="text-xl font-bold mb-6">ğŸ® å³æ™‚æˆ¿é–“ç›£æ§</h2>
                <div id="room-monitor" class="space-y-4"></div>
            </div>
        </div>
    </div>

    <script>
        const socket = io();
        socket.emit('admin_init');

        socket.on('admin_full_update', data => {
            // æ¸²æŸ“ç©å®¶åˆ—è¡¨
            const uList = document.getElementById('user-list');
            uList.innerHTML = data.users.map(u => `
                <div class="flex justify-between items-center bg-slate-800/50 p-4 rounded-2xl border border-slate-700/50">
                    <div class="flex items-center gap-3">
                        <span class="text-2xl">${u.avatar}</span>
                        <div>
                            <div class="font-bold text-white text-sm">${u.username}</div>
                            <div class="text-[10px] text-indigo-400 font-mono">PIN: ${u.pin}</div>
                        </div>
                    </div>
                    <div class="flex items-center gap-4">
                        <span class="text-yellow-500 font-black text-xs">${u.score} pt</span>
                        <button onclick="if(confirm('ç¢ºå®šåˆªé™¤ï¼Ÿ')) socket.emit('admin_delete_user','${u._id}')" 
                                class="text-red-500 text-[10px] font-bold hover:underline">åˆªé™¤</button>
                    </div>
                </div>
            `).join('');

            // æ¸²æŸ“æˆ¿é–“åˆ—è¡¨
            const rMon = document.getElementById('room-monitor');
            if(data.rooms.length === 0) {
                rMon.innerHTML = `<div class="text-center py-20 text-slate-600 italic">ç›®å‰ç„¡é€²è¡Œä¸­æˆ¿é–“</div>`;
                return;
            }
            rMon.innerHTML = data.rooms.map(r => `
                <div class="bg-slate-800 p-5 rounded-3xl border border-indigo-500/30">
                    <div class="flex justify-between items-center mb-4">
                        <span class="bg-indigo-600 text-white text-xs font-black px-3 py-1 rounded-lg">ROOM #${r.id}</span>
                        <button onclick="socket.emit('admin_close_room','${r.id}')" 
                                class="bg-red-500/10 text-red-500 text-[10px] px-2 py-1 rounded-md border border-red-500/20">é—œé–‰æˆ¿é–“</button>
                    </div>
                    <div class="grid grid-cols-2 gap-2">
                        ${r.players.map(p => `
                            <div class="bg-slate-900 p-2 rounded-xl flex justify-between items-center border border-slate-700/50">
                                <span class="text-[10px] font-bold">${p.avatar} ${p.username}</span>
                                <button onclick="socket.emit('admin_kick_player',{roomId:'${r.id}',socketId:'${p.socketId}'})" 
                                        class="text-orange-500 text-[10px] hover:text-white">è¸¢å‡º</button>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('');
        });
    </script>
</body>
</html>
