<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PartyBox</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        body { background: #020617; color: white; min-height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; margin: 0; font-family: sans-serif; overflow: hidden; }
        .glass { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(16px); border: 1px solid rgba(255,255,255,0.1); width: 90vw; max-width: 380px; padding: 2rem; border-radius: 2.5rem; }
        .hidden { display: none !important; }
        #toast { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: #ef4444; padding: 10px 20px; border-radius: 10px; z-index: 100; transition: 0.3s; opacity: 0; pointer-events: none; }
        .bingo-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 6px; }
        .bingo-cell { aspect-ratio: 1/1; background: #1e293b; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

    <div id="toast">æç¤ºè¨Šæ¯</div>

    <section id="view-login" class="glass space-y-4 text-center">
        <h1 class="text-4xl font-black italic mb-6">PARTY<span class="text-blue-500">BOX</span></h1>
        <input id="in-name" type="text" placeholder="ä½ çš„æš±ç¨±" class="w-full bg-slate-800/50 p-4 rounded-2xl outline-none border border-slate-700 text-center">
        
        <div id="login-btns" class="space-y-2">
            <button onclick="createRoom()" class="w-full bg-blue-600 hover:bg-blue-500 p-4 rounded-2xl font-bold shadow-lg transition">å‰µå»ºæˆ¿é–“</button>
            <div class="flex gap-2">
                <input id="in-room" type="text" placeholder="æˆ¿è™Ÿ" class="w-2/3 bg-slate-800/50 p-4 rounded-2xl outline-none border border-slate-700 text-center font-mono">
                <button onclick="joinRoom()" class="w-1/3 bg-slate-700 p-4 rounded-2xl font-bold">åŠ å…¥</button>
            </div>
        </div>
    </section>

    <section id="view-lobby" class="hidden glass space-y-6 text-center">
        <div>
            <p class="text-slate-400 text-sm">æ­£åœ¨æˆ¿é–“å…§</p>
            <h2 id="lab-room" class="text-4xl font-black text-blue-400 font-mono tracking-tighter">----</h2>
        </div>
        <div id="player-list" class="flex flex-wrap gap-2 justify-center"></div>
        <div id="host-controls" class="hidden border-t border-slate-700 pt-6 space-y-2">
            <button onclick="socket.emit('start_game_with_config', {roomId:myRoom, gameType:'bingo'})" class="w-full bg-blue-900/40 border border-blue-500 p-3 rounded-xl font-bold">å•Ÿå‹•è³“æœ</button>
            <button onclick="socket.emit('start_game_with_config', {roomId:myRoom, gameType:'spy'})" class="w-full bg-green-900/40 border border-green-500 p-3 rounded-xl font-bold">å•Ÿå‹•è‡¥åº•</button>
        </div>
    </section>

    <script>
        const socket = io();
        let myRoom = null, myName = null;

        // åå¸é€šçŸ¥å–ä»£å½ˆçª—
        function showToast(msg, color = "#ef4444") {
            const t = document.getElementById('toast');
            t.innerText = msg;
            t.style.background = color;
            t.style.opacity = "1";
            setTimeout(() => t.style.opacity = "0", 2500);
        }

        socket.on('toast', msg => showToast(msg));
        socket.on('admin_msg', msg => showToast(msg, "#f59e0b"));

        // å‰µå»ºæˆ¿é–“ï¼šæˆåŠŸå¾Œè‡ªå‹•è§¸ç™¼åŠ å…¥
        function createRoom() {
            myName = document.getElementById('in-name').value;
            if(!myName) return showToast("è«‹è¼¸å…¥æš±ç¨±");
            socket.emit('create_room');
        }

        socket.on('room_created', d => {
            myRoom = d.roomId;
            socket.emit('join_room', { roomId: d.roomId, username: myName });
        });

        // åŠ å…¥æˆ¿é–“
        function joinRoom() {
            myName = document.getElementById('in-name').value;
            myRoom = document.getElementById('in-room').value;
            if(!myName || !myRoom) return showToast("è«‹å¡«å¯«å®Œæ•´");
            socket.emit('join_room', { roomId: myRoom, username: myName });
        }

        // é€²å…¥å¤§å»³
        socket.on('room_update', d => {
            v('view-lobby');
            myRoom = d.roomId;
            document.getElementById('lab-room').innerText = d.roomId;
            document.getElementById('host-controls').classList.toggle('hidden', socket.id !== d.hostId);
            document.getElementById('player-list').innerHTML = d.players.map(p => 
                `<span class="bg-slate-800 px-3 py-1 rounded-full text-xs border border-white/10">${p.id === d.hostId ? 'ğŸ‘‘' : ''}${p.name}</span>`
            ).join('');
        });

        function v(id) {
            document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
        }
    </script>
</body>
</html>
