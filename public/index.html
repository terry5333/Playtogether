<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Morandi æ´¾å°éŠæˆ²ç›’</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .bingo-cell { aspect-ratio: 1 / 1; transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); }
        .glass-card { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); }
        @keyframes pulse-orange { 0%, 100% { border-color: #f97316; } 50% { border-color: #fdba74; } }
        .active-turn-border { border-width: 4px; animation: pulse-orange 2s infinite; }
    </style>
</head>
<body class="bg-slate-50 min-h-screen font-sans text-slate-900">

    <div id="lobby" class="flex items-center justify-center min-h-screen p-4">
        <div class="glass-card p-8 rounded-[2.5rem] shadow-2xl w-full max-w-md space-y-6 border border-white">
            <div class="text-center space-y-2">
                <h1 class="text-4xl font-black text-slate-800 tracking-tight">éŠæˆ²ç›’</h1>
                <p class="text-slate-400 text-sm font-medium uppercase tracking-widest">Party Game Box</p>
            </div>
            
            <div class="space-y-4">
                <input type="text" id="username" placeholder="ä½ çš„æš±ç¨±" class="w-full p-4 border-none rounded-2xl bg-slate-100 focus:ring-2 focus:ring-blue-400 outline-none transition">
                <input type="text" id="roomId" placeholder="æˆ¿é–“è™Ÿç¢¼" class="w-full p-4 border-none rounded-2xl bg-slate-100 focus:ring-2 focus:ring-blue-400 outline-none transition">
                
                <div class="grid grid-cols-2 gap-3">
                    <div class="space-y-1">
                        <span class="text-[10px] font-bold text-slate-400 ml-2">æœ€å¤§äººæ•¸</span>
                        <input type="number" id="maxPlayers" value="5" class="w-full p-3 border-none rounded-xl bg-slate-100 outline-none font-bold">
                    </div>
                    <div class="space-y-1">
                        <span class="text-[10px] font-bold text-slate-400 ml-2">å‹åˆ©ç·šæ•¸</span>
                        <input type="number" id="winLines" value="3" class="w-full p-3 border-none rounded-xl bg-slate-100 outline-none font-bold">
                    </div>
                </div>

                <select id="gameSelect" class="w-full p-4 border-none rounded-2xl bg-slate-100 outline-none font-bold text-slate-600 appearance-none cursor-pointer">
                    <option value="bingo">è³“æœé€£é€£çœ‹</option>
                    <option value="spy">èª°æ˜¯è‡¥åº•</option>
                </select>
                
                <button onclick="confirmJoin()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-black py-4 rounded-2xl shadow-xl shadow-blue-200 transition-all active:scale-95">
                    é€²å…¥å¤§å»³
                </button>
            </div>
        </div>
    </div>

    <div id="game-area" class="hidden max-w-lg mx-auto p-4 py-8">
        <div class="flex justify-between items-center mb-8 px-2">
            <div>
                <h2 id="display-room-id" class="text-xs font-black text-slate-300 uppercase tracking-tighter">ROOM ID: -</h2>
                <div id="turn-status" class="text-2xl font-black text-slate-800">ç­‰å¾…ä¸­...</div>
            </div>
            <div id="spy-timer" class="font-mono text-red-500 font-bold text-xl"></div>
        </div>

        <div id="bingo-container" class="hidden space-y-4">
            <div class="flex justify-between items-center bg-white p-4 rounded-2xl shadow-sm border border-slate-100">
                <span id="fill-hint" class="text-sm font-bold text-blue-500">ğŸ“¥ è«‹ä¾åºé»æ“Šæ ¼å­å¡«å…¥è™Ÿç¢¼</span>
                <button onclick="autoFillRandom()" class="text-xs bg-slate-800 text-white px-4 py-2 rounded-full font-bold hover:bg-black transition">ä¸€éµéš¨æ©Ÿ</button>
            </div>
            <div id="bingo-grid" class="grid grid-cols-5 gap-2 bg-white p-3 rounded-[2rem] shadow-xl border-4 border-white">
                </div>
        </div>

        <div id="spy-container" class="hidden space-y-6">
            <div id="spy-card" class="bg-white p-10 rounded-[2.5rem] shadow-xl text-center border-b-[12px] border-blue-500">
                </div>
            <div id="vote-area" class="grid grid-cols-2 gap-3">
                </div>
        </div>

        <div id="host-controls" class="hidden mt-10">
            <button onclick="sendStartGame()" class="w-full bg-orange-500 hover:bg-orange-600 text-white font-black py-5 rounded-[1.5rem] shadow-2xl shadow-orange-200 transition-all active:scale-95 text-lg">
                æˆ¿é•·é–‹å§‹éŠæˆ²
            </button>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io(); //
        let curRoom = "";
        let isHost = false;
        window.isMyTurn = false;

        function confirmJoin() {
            const username = document.getElementById('username').value;
            const roomId = document.getElementById('roomId').value;
            const gameType = document.getElementById('gameSelect').value;
            const maxPlayers = document.getElementById('maxPlayers').value;

            if (username && roomId) {
                curRoom = roomId;
                document.getElementById('display-room-id').innerText = `ROOM ID: ${roomId}`;
                socket.emit('join_room', { roomId, username, gameType, maxPlayers });
                
                document.getElementById('lobby').classList.add('hidden');
                document.getElementById('game-area').classList.remove('hidden');
                
                if (gameType === 'bingo') {
                    document.getElementById('bingo-container').classList.remove('hidden');
                    if(typeof initBingoBoard === 'function') initBingoBoard();
                } else {
                    document.getElementById('spy-container').classList.remove('hidden');
                }
            } else {
                alert("è«‹å®Œæ•´è¼¸å…¥æš±ç¨±èˆ‡æˆ¿è™Ÿ");
            }
        }

        function sendStartGame() {
            const lines = document.getElementById('winLines').value;
            socket.emit('start_game', { roomId: curRoom, winLines: lines });
        }

        socket.on('room_update', (room) => {
            isHost = (socket.id === room.host);
            if (isHost && !room.gameStarted) {
                document.getElementById('host-controls').classList.remove('hidden');
            }
        });

        socket.on('game_begin', (data) => {
            document.getElementById('host-controls').classList.add('hidden');
            updateTurnUI(data.turnId);
            if (data.gameType === 'spy' && typeof startSpyGame === 'function') startSpyGame();
        });

        socket.on('next_turn', (data) => updateTurnUI(data.turnId));

        socket.on('force_disconnect', (msg) => {
            alert(msg || "æˆ¿é–“å·²é—œé–‰");
            location.reload();
        });

        function updateTurnUI(turnId) {
            window.isMyTurn = (socket.id === turnId);
            const statusEl = document.getElementById('turn-status');
            statusEl.innerText = window.isMyTurn ? "ğŸ”´ ä½ çš„å›åˆ" : "âŒ› ç­‰å¾…å°æ‰‹";
            
            // è³“æœç›¤ç™¼å…‰ç‰¹æ•ˆ
            const grid = document.getElementById('bingo-grid');
            if (window.isMyTurn) grid.classList.add('active-turn-border');
            else grid.classList.remove('active-turn-border');
        }
    </script>
    <script src="bingo.js"></script>
    <script src="spy.js"></script>
</body>
</html>
