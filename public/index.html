<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PartyBox 玩家端</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        body { background: #0f172a; color: white; min-height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; overflow-x: hidden; margin: 0; }
        .glass { background: rgba(30, 41, 59, 0.75); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.1); width: 92vw; max-width: 400px; border-radius: 2rem; }
        .hidden { display: none !important; }
        .bingo-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 5px; }
        .bingo-cell { aspect-ratio: 1/1; background: #1e293b; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-weight: 800; cursor: pointer; }
        .bingo-cell.marked { background: #16a34a !important; box-shadow: 0 0 10px #16a34a; }
        #canvas { background: white; border-radius: 1rem; touch-action: none; width: 100%; }
    </style>
</head>
<body>

    <section id="view-login" class="glass p-8 space-y-4">
        <h1 class="text-3xl font-black text-center mb-4">PARTY<span class="text-blue-500">BOX</span></h1>
        <input id="in-name" type="text" placeholder="你的暱稱" class="w-full bg-slate-800 p-4 rounded-xl outline-none text-center">
        <button onclick="socket.emit('create_room')" class="w-full bg-blue-600 p-4 rounded-xl font-bold">創建房間</button>
        <input id="in-room" type="text" placeholder="輸入 4 位房號" class="w-full bg-slate-800 p-4 rounded-xl text-center">
        <button onclick="joinRoom()" class="w-full bg-slate-700 p-4 rounded-xl font-bold">加入房間</button>
    </section>

    <section id="view-bingo" class="hidden glass p-6 space-y-4">
        <div id="bingo-status" class="text-center py-2 bg-slate-800 rounded-lg font-bold">填寫 25 個數字</div>
        <div id="bingo-board" class="bingo-grid"></div>
        <div id="bingo-pad" class="grid grid-cols-5 gap-2"></div>
    </section>

    <script>
        const socket = io();
        let myName, myRoom, bData = new Array(25).fill(null), curCellIdx = 0;

        function joinRoom() {
            myName = document.getElementById('in-name').value;
            myRoom = document.getElementById('in-room').value;
            socket.emit('join_room', { roomId: myRoom, username: myName });
        }

        socket.on('room_created', d => { myRoom = d.roomId; alert("房號：" + d.roomId); joinRoom(); });

        socket.on('game_begin', d => {
            if(d.gameType === 'bingo') {
                showBingo();
            } else if(d.gameType === 'spy') {
                alert("你的身份詞：" + d.word);
            }
        });

        function showBingo() {
            document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
            document.getElementById('view-bingo').classList.remove('hidden');
            const board = document.getElementById('bingo-board');
            board.innerHTML = '';
            for(let i=0; i<25; i++) {
                const cell = document.createElement('div');
                cell.className = 'bingo-cell';
                cell.id = `cell-${i}`;
                board.appendChild(cell);
            }
            // 填號按鈕... (略，填滿後執行 socket.emit('sync_bingo_board', {roomId: myRoom, board: bData}))
        }

        // 賓果獲勝判定 1 條線
        function checkBingo() {
            const cells = document.querySelectorAll('.bingo-cell');
            const lines = [
                [0,1,2,3,4],[5,6,7,8,9],[10,11,12,13,14],[15,16,17,18,19],[20,21,22,23,24], // 橫
                [0,5,10,15,20],[1,6,11,16,21],[2,7,12,17,22],[3,8,13,18,23],[4,9,14,19,24], // 豎
                [0,6,12,18,24],[4,8,12,16,20] // 斜
            ];
            return lines.some(line => line.every(idx => cells[idx].classList.contains('marked')));
        }
    </script>
</body>
</html>
