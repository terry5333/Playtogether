<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>PlayTogether - Bingo</title>
    <style>
        body { font-family: sans-serif; text-align: center; background: #f4f7f6; }
        .grid { display: grid; grid-template-columns: repeat(5, 60px); gap: 8px; justify-content: center; margin-top: 20px; }
        .cell { width: 60px; height: 60px; background: white; border: 2px solid #333; 
                display: flex; align-items: center; justify-content: center; 
                font-weight: bold; cursor: pointer; border-radius: 5px; }
        .cell.marked { background: #ff4757; color: white; border-color: #ff4757; }
        .status-box { margin: 20px; padding: 10px; background: #dfe4ea; border-radius: 8px; display: inline-block; }
    </style>
</head>
<body>
    <h1>大家來 Bingo！</h1>
    <div class="status-box">
        <input type="text" id="roomInput" placeholder="房間號碼">
        <button onclick="joinRoom()">進入房間</button>
        <p id="status">請先加入房間</p>
    </div>

    <div class="grid" id="bingoGrid"></div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let currentRoom = "";
        let myNumbers = [];

        // 1. 生成 1-25 隨機洗牌數字
        function generateBingo() {
            const nums = Array.from({length: 25}, (_, i) => i + 1);
            nums.sort(() => Math.random() - 0.5);
            const grid = document.getElementById('bingoGrid');
            grid.innerHTML = '';
            
            nums.forEach(num => {
                const div = document.createElement('div');
                div.className = 'cell';
                div.innerText = num;
                div.id = `num-${num}`;
                div.onclick = () => pickNumber(num);
                grid.appendChild(div);
            });
        }

        function joinRoom() {
            currentRoom = document.getElementById('roomInput').value;
            if (currentRoom) {
                socket.emit('join_room', currentRoom);
                document.getElementById('status').innerText = `已加入房間：${currentRoom}`;
                generateBingo();
            }
        }

        // 2. 點選數字
        function pickNumber(num) {
            if (!currentRoom) return;
            // 標記自己畫面的數字
            markNumber(num);
            // 告訴對手也要標記這個數字
            socket.emit('game_move', { roomId: currentRoom, number: num });
        }

        // 3. 標記數字的視覺效果
        function markNumber(num) {
            const cell = document.getElementById(`num-${num}`);
            if (cell && !cell.classList.contains('marked')) {
                cell.classList.add('marked');
            }
        }

        // 4. 接收對手點選的數字
        socket.on('receive_move', (data) => {
            if (data.number) {
                markNumber(data.number);
            }
        });
    </script>
</body>
</html>
