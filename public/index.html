<div id="turn-indicator" class="w-full py-2 mb-2 rounded-lg text-center text-xs font-bold tracking-widest uppercase transition-all shadow-inner">
    等待遊戲開始...
</div>

<script>
    let isMyTurn = false; // 新增變數追蹤是否輪到自己

    // 修改 startGame 邏輯 (房主可以觸發，或是人數滿了自動觸發)
    // 這裡假設房主是第一個，所以一開始如果是房主，isMyTurn = true (視你的規則而定)

    function mark(num, isFromMe) {
        const btn = document.getElementById(`cell-${num}`);
        if(btn && !btn.disabled) {
            btn.disabled = true;
            btn.className = "aspect-square cell-marked rounded-xl text-lg font-bold shadow-inner opacity-80";
            
            const idxInLayout = myLayout.indexOf(num);
            boardState[idxInLayout] = true;
            
            if (isFromMe) {
                // 如果是我點的，點完後立刻關閉我的回合，直到接收到 Server 通知
                isMyTurn = false;
                updateTurnUI();
            }
            check();
        }
    }

    // 更新回合 UI 的顏色與文字
    function updateTurnUI() {
        const el = document.getElementById('turn-indicator');
        if (isMyTurn) {
            el.innerText = "YOUR TURN | 請喊號碼";
            el.className = "w-full py-2 mb-2 rounded-lg text-center text-xs font-bold bg-[#B4C4B8] text-white animate-pulse";
        } else {
            el.innerText = "WAITING | 等待對方喊號";
            el.className = "w-full py-2 mb-2 rounded-lg text-center text-xs font-bold bg-gray-200 text-slate-400";
        }
    }

    // 接收動作
    socket.on('receive_move', (data) => {
        mark(data.number, false);
        document.getElementById('log').innerText = `${data.senderName} 喊了 ${data.number}`;
        
        // 判斷 Server 傳來的 nextTurnId 是否為我
        isMyTurn = (socket.id === data.nextTurnId);
        updateTurnUI();
    });

    // 初始進入房間時同步
    socket.on('room_update', (data) => {
        // ... 原有的名單更新 ...
        // 如果遊戲剛開始，設定第一個進來的人(Host)先開始
        if (data.players.length >= 1 && !isMyTurn && data.host === socket.id) {
            isMyTurn = true;
            updateTurnUI();
        }
    });
</script>
