<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PartyBox Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
        body { background: #020617; color: white; }
        .view { display: none; min-height: 100vh; flex-direction: column; padding: 20px; }
        .active { display: flex; }
        .glass { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); backdrop-filter: blur(10px); }
        .bingo-cell { aspect-ratio: 1; border: 1px solid #334155; border-radius: 8px; font-weight: bold; }
        .bingo-active { background: #0891b2; border-color: #22d3ee; }
    </style>
</head>
<body>

    <div id="cfg-modal" class="hidden fixed inset-0 bg-black/95 z-[100] flex items-center justify-center p-6">
        <div class="glass p-8 rounded-[3rem] w-full max-w-sm text-center">
            <h3 id="cfg-title" class="text-xl font-bold mb-4 text-cyan-400">éŠæˆ²è¨­å®š</h3>
            <p id="cfg-desc" class="text-xs text-slate-400 mb-6"></p>
            <input id="cfg-input" type="number" class="w-full bg-white/10 p-4 rounded-2xl text-center mb-8 border border-white/10">
            <button onclick="launchGame()" class="w-full bg-cyan-600 p-4 rounded-2xl font-black">æ­£å¼é–‹å§‹</button>
        </div>
    </div>

    <section id="v-room" class="view">
        <h2 id="r-id" class="text-4xl font-black mb-8">----</h2>
        <div id="player-list" class="space-y-2 flex-1"></div>
        
        <div id="host-controls" class="hidden grid grid-cols-2 gap-2 mt-6">
            <button onclick="socket.emit('host_setup_trigger','SPY')" class="glass p-4 rounded-2xl">ğŸ•µï¸ èª°æ˜¯è‡¥åº•</button>
            <button onclick="socket.emit('host_setup_trigger','BINGO')" class="glass p-4 rounded-2xl">ğŸ”¢ Bingo</button>
        </div>
    </section>

    <section id="v-play" class="view">
        <div id="game-container" class="flex-1 flex flex-col"></div>
    </section>

    <script>
        const socket = io();
        let myUser, currentMode, bingoCount = 0;

        // --- æˆ¿ä¸»è¨­å®šæµ ---
        socket.on('open_config_ui', (mode) => {
            currentMode = mode;
            document.getElementById('cfg-modal').classList.remove('hidden');
            const input = document.getElementById('cfg-input');
            const desc = document.getElementById('cfg-desc');
            if(mode === 'SPY') { desc.innerText="è¨­å®šç™¼è¨€è¨è«–ç§’æ•¸"; input.value=60; }
            if(mode === 'BINGO') { desc.innerText="è¨­å®šç²å‹é€£ç·šæ•¸"; input.value=3; }
        });

        function launchGame() {
            const val = document.getElementById('cfg-input').value;
            socket.emit('start_game_final', { mode: currentMode, val: val });
            document.getElementById('cfg-modal').classList.add('hidden');
        }

        // --- Bingo è§¸æ§å¡«è™Ÿé‚è¼¯ ---
        socket.on('game_init', (data) => {
            document.querySelectorAll('.view').forEach(v=>v.classList.remove('active'));
            document.getElementById('v-play').classList.add('active');
            const container = document.getElementById('game-container');

            if(data.type === 'BINGO') {
                container.innerHTML = `<p class="text-center text-cyan-500 mb-4 animate-pulse">è«‹ä¾åºé»æ“Šæ ¼å­å¡«å…¥ 1-25</p>
                                       <div id="b-grid" class="grid grid-cols-5 gap-2"></div>`;
                for(let i=0; i<25; i++) {
                    const btn = document.createElement('button');
                    btn.className = 'bingo-cell glass';
                    btn.onclick = () => {
                        if(btn.innerText) return;
                        bingoCount++;
                        btn.innerText = bingoCount;
                        btn.classList.add('bingo-active');
                    };
                    document.getElementById('b-grid').appendChild(btn);
                }
            }
            // èª°æ˜¯è‡¥åº•é‚è¼¯...
        });
    </script>
</body>
</html>
