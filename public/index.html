<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PartyBox ğŸŒˆ Healing</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
        :root { --sand: #F2EBE1; --blue: #A2C2D8; --mint: #B2D8D8; --gray: #5D6D7E; }
        body { background: var(--sand); color: var(--gray); font-family: sans-serif; }
        .card { background: white; border-radius: 2.5rem; box-shadow: 0 15px 35px rgba(0,0,0,0.05); }
        .btn-blue { background: var(--blue); color: white; border-radius: 1.25rem; }
        .btn-mint { background: var(--mint); color: #4A6A6A; font-weight: bold; border-radius: 1.25rem; }
        .btn-active:active { transform: scale(0.95); opacity: 0.9; }
        .host-star { color: #F1C40F; animation: pulse 1s infinite; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.2); } }
        .hidden { display: none !important; }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">
    <div id="toast" class="fixed top-8 bg-black/70 text-white px-6 py-3 rounded-full opacity-0 transition-opacity z-[999] pointer-events-none"></div>

    <section id="view-lobby" class="card p-8 w-full max-w-sm space-y-6 text-center">
        <h1 class="text-4xl font-black" style="color: var(--blue)">PARTYBOX âœ¨</h1>
        
        <div id="login-area" class="space-y-4">
            <input id="in-name" type="text" placeholder="ğŸ¨ è¼¸å…¥æš±ç¨±..." class="w-full p-4 rounded-2xl bg-gray-100 text-center outline-none">
            
            <button onclick="handleCreate()" class="w-full p-5 btn-blue btn-active font-black text-lg">
                å‰µå»ºæˆ¿é–“ ğŸ 
            </button>
            
            <div class="flex gap-2">
                <input id="in-room" type="number" placeholder="4ä½æˆ¿è™Ÿ" class="w-2/3 p-4 rounded-2xl bg-gray-100 text-center outline-none">
                <button onclick="handleJoin()" class="w-1/3 bg-gray-200 rounded-2xl font-bold text-gray-500 btn-active">åŠ å…¥</button>
            </div>
        </div>

        <div id="room-info" class="hidden space-y-5">
            <div class="py-4 bg-gray-50 rounded-3xl border-2 border-dashed border-gray-200">
                <p class="text-[10px] font-bold text-gray-400 uppercase tracking-widest">æˆ¿è™Ÿ</p>
                <h2 id="rid-text" class="text-5xl font-black">----</h2>
            </div>
            
            <div class="text-left space-y-2">
                <p class="text-[10px] font-bold text-gray-400 ml-1">ç©å®¶åå–® ğŸ‘¥</p>
                <div id="player-list" class="space-y-2"></div>
            </div>

            <div id="host-zone" class="hidden pt-4 border-t space-y-3">
                <select id="set-goal" class="w-full p-4 bg-gray-50 rounded-2xl border-none font-bold text-gray-500">
                    <option value="3">ğŸ¯ 3 æ¢ç·šå‹</option>
                    <option value="5">ğŸ¯ 5 æ¢ç·šå‹</option>
                </select>
                <button onclick="handleStart()" class="w-full p-5 btn-mint btn-active text-lg">
                    é–‹å§‹ æ•¸å­—è³“æœ ğŸ²
                </button>
            </div>
        </div>
    </section>

    <script>
        // åˆå§‹åŒ– Socketï¼Œå¸¶å…¥éŒ¯èª¤ç›£è½
        const socket = io();
        let myRid, myUserName, bingoArr = [], goal = 3;

        socket.on('connect', () => console.log("ä¼ºæœå™¨é€£ç·šæˆåŠŸï¼"));
        socket.on('connect_error', () => showToast("ğŸ”´ ç„¡æ³•é€£ç·šè‡³ä¼ºæœå™¨ï¼Œè«‹é‡æ•´"));

        function showToast(msg) {
            const t = document.getElementById('toast');
            t.innerText = msg; t.style.opacity = 1;
            setTimeout(() => t.style.opacity = 0, 2000);
        }

        // ä¿®æ”¹å¾Œçš„æŒ‰éˆ•å‡½æ•¸
        function handleCreate() {
            myUserName = document.getElementById('in-name').value;
            if(!myUserName) return showToast("ğŸ­ è«‹å…ˆè¼¸å…¥åå­—");
            if(!socket.connected) return showToast("â³ é€£ç·šä¸­ï¼Œè«‹ç¨å€™å†æŒ‰ä¸€æ¬¡");
            
            console.log("ç™¼é€å‰µå»ºè«‹æ±‚...");
            socket.emit('create_room');
        }

        function handleJoin() {
            myUserName = document.getElementById('in-name').value;
            let rid = document.getElementById('in-room').value;
            if(!myUserName || !rid) return showToast("ğŸ§© åå­—è·Ÿæˆ¿è™Ÿéƒ½è¦å¡«");
            socket.emit('join_room', {roomId: rid, username: myUserName});
        }

        function handleStart() {
            socket.emit('start_game', {gameType: 'bingo', roomId: myRid, goal: document.getElementById('set-goal').value});
        }

        socket.on('room_created', d => {
            console.log("æ”¶åˆ°æˆ¿è™Ÿ:", d.roomId);
            myRid = d.roomId;
            socket.emit('join_room', {roomId: d.roomId, username: myUserName});
        });

        socket.on('room_update', d => {
            document.getElementById('login-area').classList.add('hidden');
            document.getElementById('room-info').classList.remove('hidden');
            document.getElementById('rid-text').innerText = d.roomId;
            myRid = d.roomId;
            document.getElementById('host-zone').classList.toggle('hidden', socket.id !== d.hostId);
            
            document.getElementById('player-list').innerHTML = d.players.map(p => `
                <div class="flex justify-between items-center bg-gray-50 p-4 rounded-2xl border border-gray-100">
                    <span class="font-bold text-sm">${p.id === d.hostId ? '<span class="host-star">â˜…</span>' : 'ğŸ‘¤'} ${p.name}</span>
                </div>
            `).join('');
        });

        socket.on('toast', m => showToast(m));
    </script>
</body>
</html>
