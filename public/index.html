<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Morandi æ´¾å°éŠæˆ²ç›’</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .bingo-cell { transition: all 0.2s; }
        .bingo-cell:active { transform: scale(0.9); }
        canvas { touch-action: none; } /* é˜²æ­¢æ‰‹æ©Ÿç¹ªåœ–æ™‚ç•«é¢æ²å‹• */
    </style>
</head>
<body class="bg-slate-50 min-h-screen">

    <div id="lobby" class="flex flex-col items-center justify-center min-h-screen p-4">
        <div class="bg-white p-8 rounded-3xl shadow-xl w-full max-w-md space-y-6">
            <h1 class="text-3xl font-bold text-center text-slate-700">æ´¾å°éŠæˆ²ç›’</h1>
            <div class="space-y-4">
                <input type="text" id="username" placeholder="ä½ çš„æš±ç¨±" class="w-full p-4 border rounded-2xl focus:ring-2 focus:ring-blue-400 outline-none">
                <input type="text" id="roomId" placeholder="æˆ¿é–“è™Ÿç¢¼" class="w-full p-4 border rounded-2xl focus:ring-2 focus:ring-blue-400 outline-none">
                <select id="gameSelect" class="w-full p-4 border rounded-2xl bg-white outline-none">
                    <option value="bingo">è³“æœé€£é€£çœ‹</option>
                    <option value="draw">ä½ ç•«æˆ‘çŒœ</option>
                    <option value="spy">èª°æ˜¯è‡¥åº•</option>
                </select>
                <button onclick="confirmJoin()" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-4 rounded-2xl shadow-lg transition">
                    åŠ å…¥æˆ¿é–“
                </button>
            </div>
        </div>
    </div>

    <div id="game-area" class="hidden p-4 max-w-4xl mx-auto">
        <div class="flex justify-between items-center mb-6">
            <h2 id="room-display" class="text-xl font-bold text-slate-600">æˆ¿é–“ï¼š-</h2>
            <button onclick="location.reload()" class="text-sm text-red-400">é€€å‡ºæˆ¿é–“</button>
        </div>

        <div id="bingo-area" class="hidden space-y-4">
            <div id="bingo-grid" class="grid grid-cols-5 gap-2 bg-white p-4 rounded-3xl shadow-inner border-8 border-slate-100">
                </div>
            <p class="text-center text-slate-400 text-sm">é»æ“Šæ ¼å­å¡«å…¥æ•¸å­— (1-25)</p>
        </div>

        <div id="draw-area" class="hidden flex flex-col items-center">
            <canvas id="canvas" width="350" height="400" class="bg-white rounded-3xl shadow-lg border-4 border-white cursor-crosshair"></canvas>
            <button onclick="clearCanvas()" class="mt-4 px-6 py-2 bg-slate-200 rounded-full text-slate-600">æ¸…é™¤ç•«å¸ƒ</button>
        </div>

        <div id="spy-area" class="hidden bg-white p-10 rounded-3xl shadow-lg text-center">
            <p class="text-slate-500 mb-4">ç­‰å¾…æˆ¿é•·é–‹å§‹éŠæˆ²...</p>
        </div>

        <div id="host-controls" class="hidden mt-10">
            <button onclick="startGame()" class="w-full bg-orange-400 hover:bg-orange-500 text-white font-bold py-4 rounded-2xl shadow-lg transition">
                é–‹å§‹éŠæˆ² (åƒ…æˆ¿é•·)
            </button>
        </div>

        <div class="mt-8">
            <h3 class="text-sm font-bold text-slate-400 mb-2 uppercase tracking-widest">åœ¨ç·šç©å®¶</h3>
            <div id="player-list" class="flex flex-wrap gap-2"></div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>

    <script>
        const socket = io(); // å®šç¾©å…¨åŸŸ socket ä¾›æ‰€æœ‰ js ä½¿ç”¨
        let curRoom = "";
        let isHost = false;

        function confirmJoin() {
            const username = document.getElementById('username').value;
            const roomId = document.getElementById('roomId').value;
            const gameType = document.getElementById('gameSelect').value;

            if (username && roomId) {
                curRoom = roomId;
                document.getElementById('room-display').innerText = `æˆ¿é–“ï¼š${roomId}`;
                
                // ç™¼é€åŠ å…¥æˆ¿é–“è¨Šè™Ÿ
                socket.emit('join_room', { roomId, username, gameType });

                // UI åˆ‡æ›
                document.getElementById('lobby').classList.add('hidden');
                document.getElementById('game-area').classList.remove('hidden');

                // æ ¹æ“šéŠæˆ²é¡å‹é¡¯ç¤ºå€åŸŸ
                if (gameType === 'bingo') {
                    document.getElementById('bingo-area').classList.remove('hidden');
                    if (typeof initBingoBoard === 'function') initBingoBoard(); //
                } else if (gameType === 'draw') {
                    document.getElementById('draw-area').classList.remove('hidden');
                    if (typeof initDraw === 'function') initDraw(); //
                } else if (gameType === 'spy') {
                    document.getElementById('spy-area').classList.remove('hidden');
                }
            } else {
                alert("è«‹å¡«å¯«æš±ç¨±èˆ‡æˆ¿é–“è™Ÿç¢¼");
            }
        }

        function startGame() {
            socket.emit('start_game', { roomId: curRoom });
        }

        // ç›£è½æˆ¿é–“æ›´æ–°ï¼Œç¢ºèªæˆ¿é•·æ¬Šé™
        socket.on('room_update', (room) => {
            isHost = (socket.id === room.host);
            if (isHost && !room.gameStarted) {
                document.getElementById('host-controls').classList.remove('hidden');
            }
            
            const pList = document.getElementById('player-list');
            pList.innerHTML = room.players.map(p => 
                `<span class="px-4 py-1 bg-slate-200 rounded-full text-sm text-slate-600">${p.name} ${p.id === room.host ? 'ğŸ‘‘' : ''}</span>`
            ).join('');
        });

        function clearCanvas() {
            const canvas = document.getElementById('canvas');
            if(canvas) {
                const ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);
            }
        }
    </script>

    <script src="bingo.js"></script>
    <script src="draw.js"></script>
    <script src="spy.js"></script>

</body>
</html>
