<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-4">
    <div id="lobby" class="max-w-md mx-auto bg-white p-6 rounded-xl shadow-lg space-y-4">
        <h1 class="text-2xl font-bold">遊戲盒</h1>
        <input type="text" id="username" placeholder="暱稱" class="w-full border p-2 rounded">
        <input type="text" id="roomId" placeholder="房號" class="w-full border p-2 rounded">
        <div class="grid grid-cols-2 gap-2 text-sm">
            <input type="number" id="maxPlayers" value="5" title="最大人數" class="border p-2 rounded">
            <input type="number" id="winLines" value="3" title="勝利線數" class="border p-2 rounded">
        </div>
        <select id="gameSelect" class="w-full border p-2 rounded">
            <option value="bingo">賓果</option>
            <option value="spy">誰是臥底</option>
        </select>
        <button onclick="join()" class="w-full bg-blue-500 text-white p-2 rounded">加入</button>
    </div>

    <div id="game-area" class="hidden">
        <div id="turn-status" class="text-center text-xl font-bold text-red-500 my-4"></div>
        <div id="spy-timer" class="text-center text-gray-600 mb-4"></div>
        
        <div id="bingo-grid" class="grid grid-cols-5 gap-1 max-w-sm mx-auto"></div>
        <div id="spy-area" class="text-center"></div>

        <div id="host-controls" class="hidden mt-6">
            <button onclick="start()" class="w-full bg-orange-500 text-white p-3 rounded-xl font-bold">開始遊戲</button>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let curRoom = "", isHost = false, myPlayers = [];

        function join() {
            const data = {
                roomId: document.getElementById('roomId').value,
                username: document.getElementById('username').value,
                gameType: document.getElementById('gameSelect').value,
                maxPlayers: document.getElementById('maxPlayers').value
            };
            curRoom = data.roomId;
            socket.emit('join_room', data);
            document.getElementById('lobby').classList.add('hidden');
            document.getElementById('game-area').classList.remove('hidden');
        }

        function start() {
            const lines = document.getElementById('winLines').value;
            socket.emit('start_game', { roomId: curRoom, winLines: lines });
        }

        socket.on('room_update', (room) => {
            isHost = (socket.id === room.host);
            myPlayers = room.players;
            if (isHost && !room.gameStarted) document.getElementById('host-controls').classList.remove('hidden');
        });

        socket.on('game_begin', (data) => {
            document.getElementById('host-controls').classList.add('hidden');
            updateTurn(data.turnId);
            if (data.gameType === 'bingo') initBingoBoard();
            if (data.gameType === 'spy') startSpyGame();
        });

        socket.on('next_turn', (data) => updateTurn(data.turnId));

        function updateTurn(id) {
            window.isMyTurn = (socket.id === id);
            document.getElementById('turn-status').innerText = window.isMyTurn ? "★ 你的回合 ★" : "等待對手中...";
        }
    </script>
    <script src="bingo.js"></script>
    <script src="spy.js"></script>
</body>
</html><!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-4">
    <div id="lobby" class="max-w-md mx-auto bg-white p-6 rounded-xl shadow-lg space-y-4">
        <h1 class="text-2xl font-bold">遊戲盒</h1>
        <input type="text" id="username" placeholder="暱稱" class="w-full border p-2 rounded">
        <input type="text" id="roomId" placeholder="房號" class="w-full border p-2 rounded">
        <div class="grid grid-cols-2 gap-2 text-sm">
            <input type="number" id="maxPlayers" value="5" title="最大人數" class="border p-2 rounded">
            <input type="number" id="winLines" value="3" title="勝利線數" class="border p-2 rounded">
        </div>
        <select id="gameSelect" class="w-full border p-2 rounded">
            <option value="bingo">賓果</option>
            <option value="spy">誰是臥底</option>
        </select>
        <button onclick="join()" class="w-full bg-blue-500 text-white p-2 rounded">加入</button>
    </div>

    <div id="game-area" class="hidden">
        <div id="turn-status" class="text-center text-xl font-bold text-red-500 my-4"></div>
        <div id="spy-timer" class="text-center text-gray-600 mb-4"></div>
        
        <div id="bingo-grid" class="grid grid-cols-5 gap-1 max-w-sm mx-auto"></div>
        <div id="spy-area" class="text-center"></div>

        <div id="host-controls" class="hidden mt-6">
            <button onclick="start()" class="w-full bg-orange-500 text-white p-3 rounded-xl font-bold">開始遊戲</button>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let curRoom = "", isHost = false, myPlayers = [];

        function join() {
            const data = {
                roomId: document.getElementById('roomId').value,
                username: document.getElementById('username').value,
                gameType: document.getElementById('gameSelect').value,
                maxPlayers: document.getElementById('maxPlayers').value
            };
            curRoom = data.roomId;
            socket.emit('join_room', data);
            document.getElementById('lobby').classList.add('hidden');
            document.getElementById('game-area').classList.remove('hidden');
        }

        function start() {
            const lines = document.getElementById('winLines').value;
            socket.emit('start_game', { roomId: curRoom, winLines: lines });
        }

        socket.on('room_update', (room) => {
            isHost = (socket.id === room.host);
            myPlayers = room.players;
            if (isHost && !room.gameStarted) document.getElementById('host-controls').classList.remove('hidden');
        });

        socket.on('game_begin', (data) => {
            document.getElementById('host-controls').classList.add('hidden');
            updateTurn(data.turnId);
            if (data.gameType === 'bingo') initBingoBoard();
            if (data.gameType === 'spy') startSpyGame();
        });

        socket.on('next_turn', (data) => updateTurn(data.turnId));

        function updateTurn(id) {
            window.isMyTurn = (socket.id === id);
            document.getElementById('turn-status').innerText = window.isMyTurn ? "★ 你的回合 ★" : "等待對手中...";
        }
    </script>
    <script src="bingo.js"></script>
    <script src="spy.js"></script>
</body>
</html>
