<div id="game-panel" class="hidden w-full max-w-md morandi-card p-6 flex flex-col relative" style="height: 94vh;">
    <div class="flex justify-between items-center mb-2">
        <div id="status-tag" class="px-3 py-1 rounded-full btn-green text-[10px] font-bold">準備中</div>
        <div id="timer-display" class="hidden text-red-500 font-mono font-bold text-xl">60s</div>
    </div>

    <div class="flex-1 overflow-y-auto space-y-4">
        <div id="draw-ui" class="hidden space-y-2">
            <div id="painter-input-box" class="hidden bg-blue-50 p-3 rounded-2xl flex gap-2">
                <input id="topicInp" class="flex-1 p-2 rounded-xl text-xs outline-none" placeholder="輸入題目...">
                <button onclick="submitTopic()" class="px-4 btn-green rounded-xl text-xs">出題</button>
            </div>
            <div id="topic-locked-msg" class="hidden text-center p-2 bg-green-50 text-green-700 rounded-xl text-xs font-bold">✅ 題目已設定，請開始作畫</div>
            <canvas id="canvas" width="500" height="500"></canvas>
        </div>

        <div id="spy-ui" class="hidden space-y-4">
            <div id="spy-card" onclick="toggleSpy()" class="w-full h-40 bg-gray-50 rounded-3xl flex items-center justify-center border-2 border-dashed border-gray-200 cursor-pointer">
                <span id="spy-word-text" class="text-xl font-bold text-gray-400">點擊查看詞語</span>
            </div>
            <div id="vote-section" class="hidden space-y-2">
                <div class="text-center text-red-500 text-xs font-bold italic">討論時間結束，請投出臥底！</div>
                <div id="vote-grid" class="grid grid-cols-2 gap-2"></div>
            </div>
        </div>
        
        <div id="chat-box" class="h-32 overflow-y-auto bg-gray-50 rounded-2xl p-4 text-[10px]"></div>
    </div>

    <div class="mt-4 space-y-2">
        <input type="text" id="chatInp" class="w-full p-4 bg-gray-50 rounded-2xl outline-none" placeholder="輸入聊天內容...">
        <button id="startBtn" onclick="sendStart()" class="hidden w-full p-4 btn-green rounded-2xl font-bold">開始遊戲</button>
    </div>
</div>

<script>
    // 解決出題不了
    function submitTopic() {
        const word = document.getElementById('topicInp').value;
        if(!word) return;
        socket.emit('set_word', { roomId: curRoom, word: word });
    }

    socket.on('topic_locked', (data) => {
        document.getElementById('painter-input-box').classList.add('hidden');
        document.getElementById('topic-locked-msg').classList.remove('hidden');
    });

    // 解決臥底倒數與投票
    socket.on('timer_tick', (sec) => {
        const timerEl = document.getElementById('timer-display');
        timerEl.classList.remove('hidden');
        timerEl.innerText = `${sec}s`;
    });

    socket.on('start_voting', () => {
        document.getElementById('timer-display').innerText = "VOTING";
        document.getElementById('vote-section').classList.remove('hidden');
        renderVotes();
    });

    function renderVotes() {
        const grid = document.getElementById('vote-grid');
        grid.innerHTML = players.map(p => `
            <button onclick="confirmVote('${p.id}')" class="p-3 bg-white border-2 border-gray-100 rounded-xl text-[10px] font-bold hover:border-red-400">
                ${p.name} <span id="vcount-${p.id}" class="text-red-500 ml-1">0</span>
            </button>
        `).join('');
    }

    function confirmVote(tid) {
        socket.emit('cast_vote', { roomId: curRoom, targetId: tid });
        document.getElementById('vote-grid').innerHTML = `<p class="col-span-2 text-center text-gray-400 text-[10px]">投票成功，等待其他玩家...</p>`;
    }

    socket.on('vote_update', (votes) => {
        for(let id in votes) {
            const el = document.getElementById(`vcount-${id}`);
            if(el) el.innerText = votes[id];
        }
    });

    // ... 其餘角色分配與繪圖邏輯 ...
</script>
